// This file is @generated by prost-build.
#[derive(Clone, PartialEq, Eq, Hash, ::prost::Message)]
pub struct HelloMessage {
    #[prost(string, tag = "1")]
    pub message: ::prost::alloc::string::String,
}
pub mod hello {
    use rums::Configuration;
    use futures::stream::Stream;
    use std::error::Error;
    use futures::stream::StreamExt;
    use prost::Message;
    use rums::ServerHandler;
    use rums::get_route;
    use rums::add_route;
    use rums::RouteHandler;
    pub trait HelloClient {
        fn hello_world(
            &self,
            msg: &super::HelloMessage,
        ) -> impl Stream<Item = Result<super::HelloMessage, Box<dyn Error>>>;
        fn goodbye_world(
            &self,
            msg: &super::HelloMessage,
        ) -> impl Stream<Item = Result<super::HelloMessage, Box<dyn Error>>>;
    }
    impl HelloClient for Configuration {
        fn hello_world(
            &self,
            msg: &super::HelloMessage,
        ) -> impl Stream<Item = Result<super::HelloMessage, Box<dyn Error>>> {
            println!("hello, hello_world");
            let mut buf = vec![];
            msg.encode(&mut buf).unwrap();
            let buf = Box::new(
                add_route(add_route(add_route(buf, "HelloWorld"), "Hello"), "hello"),
            );
            let responses = self.send(&buf);
            responses
                .map(|res| {
                    res.map(|buf| {
                        super::HelloMessage::decode(&buf as &[u8]).unwrap()
                    })
                })
        }
        fn goodbye_world(
            &self,
            msg: &super::HelloMessage,
        ) -> impl Stream<Item = Result<super::HelloMessage, Box<dyn Error>>> {
            println!("hello, goodbye_world");
            let mut buf = vec![];
            msg.encode(&mut buf).unwrap();
            let buf = Box::new(
                add_route(add_route(add_route(buf, "GoodbyeWorld"), "Hello"), "hello"),
            );
            let responses = self.send(&buf);
            responses
                .map(|res| {
                    res.map(|buf| {
                        super::HelloMessage::decode(&buf as &[u8]).unwrap()
                    })
                })
        }
    }
    pub trait HelloServer {
        fn hello_world(
            &self,
            msg: super::HelloMessage,
        ) -> Result<super::HelloMessage, Box<dyn Error + Send>>;
        fn goodbye_world(
            &self,
            msg: super::HelloMessage,
        ) -> Result<super::HelloMessage, Box<dyn Error + Send>>;
    }
    pub struct HelloHandler {
        handlers: Box<dyn HelloServer + Send>,
    }
    impl HelloHandler {
        pub fn new(handlers: Box<dyn HelloServer + Send>) -> Self {
            Self { handlers: handlers }
        }
    }
    impl ServerHandler for HelloHandler {
        fn handle(&'_ self, request: &[u8]) -> Result<Vec<u8>, Box<dyn Error + Send>> {
            let (request, route) = get_route(request);
            println!("message routed to: {}", route);
            match route {
                "HelloWorld" => {
                    let msg = super::HelloMessage::decode(request).unwrap();
                    let rsp = self.handlers.hello_world(msg);
                    rsp.map(|msg| {
                        let mut buf = vec![];
                        msg.encode(&mut buf).unwrap();
                        buf
                    })
                }
                "GoodbyeWorld" => {
                    let msg = super::HelloMessage::decode(request).unwrap();
                    let rsp = self.handlers.goodbye_world(msg);
                    rsp.map(|msg| {
                        let mut buf = vec![];
                        msg.encode(&mut buf).unwrap();
                        buf
                    })
                }
                &_ => todo!(),
            }
        }
    }
    pub trait RegisterHelloHandler {
        fn register_hello_handler(&mut self, handler: Box<dyn ServerHandler + Send>);
    }
    impl RegisterHelloHandler for RouteHandler {
        fn register_hello_handler(&mut self, handler: Box<dyn ServerHandler + Send>) {
            self.sub_route("hello").add_route("Hello", handler);
        }
    }
}
